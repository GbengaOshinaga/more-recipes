{"version":3,"sources":["../../../dist/controllers/FavouriteRecipesController.js"],"names":["Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_index","require","_index2","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","TypeError","FavouriteRecipesController","addFavourite","req","res","foundRecipe","Recipes","findById","params","id","then","recipe","User","user","userId","addFavouriteRecipe","status","jsend","success","message","catch","error","getFavourites","getFavouriteRecipes","favourites","fail","deleteFavourites","sequelize","query","spread","getMostFavourited","results","recipes"],"mappings":"AAAA;;AAEAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,SAAO;AADoC,CAA7C;;AAIA,IAAIC,eAAe,YAAY;AAAE,WAASC,gBAAT,CAA0BC,MAA1B,EAAkCC,KAAlC,EAAyC;AAAE,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,MAAME,MAA1B,EAAkCD,GAAlC,EAAuC;AAAE,UAAIE,aAAaH,MAAMC,CAAN,CAAjB,CAA2BE,WAAWC,UAAX,GAAwBD,WAAWC,UAAX,IAAyB,KAAjD,CAAwDD,WAAWE,YAAX,GAA0B,IAA1B,CAAgC,IAAI,WAAWF,UAAf,EAA2BA,WAAWG,QAAX,GAAsB,IAAtB,CAA4Bb,OAAOC,cAAP,CAAsBK,MAAtB,EAA8BI,WAAWI,GAAzC,EAA8CJ,UAA9C;AAA4D;AAAE,GAAC,OAAO,UAAUK,WAAV,EAAuBC,UAAvB,EAAmCC,WAAnC,EAAgD;AAAE,QAAID,UAAJ,EAAgBX,iBAAiBU,YAAYG,SAA7B,EAAwCF,UAAxC,EAAqD,IAAIC,WAAJ,EAAiBZ,iBAAiBU,WAAjB,EAA8BE,WAA9B,EAA4C,OAAOF,WAAP;AAAqB,GAAhN;AAAmN,CAA9hB,EAAnB;;AAEA,IAAII,SAASC,QAAQ,iBAAR,CAAb;;AAEA,IAAIC,UAAUC,uBAAuBH,MAAvB,CAAd;;AAEA,SAASG,sBAAT,CAAgCC,GAAhC,EAAqC;AAAE,SAAOA,OAAOA,IAAIC,UAAX,GAAwBD,GAAxB,GAA8B,EAAEE,SAASF,GAAX,EAArC;AAAwD;;AAE/F,SAASG,eAAT,CAAyBC,QAAzB,EAAmCZ,WAAnC,EAAgD;AAAE,MAAI,EAAEY,oBAAoBZ,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIa,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ;;;AAGA,IAAIC,6BAA6B,YAAY;AAC3C,WAASA,0BAAT,GAAsC;AACpCH,oBAAgB,IAAhB,EAAsBG,0BAAtB;AACD;;AAEDzB,eAAayB,0BAAb,EAAyC,IAAzC,EAA+C,CAAC;AAC9Cf,SAAK,cADyC;;AAG9C;;;;;;AAMAX,WAAO,SAAS2B,YAAT,CAAsBC,GAAtB,EAA2BC,GAA3B,EAAgC;AACrC,UAAIC,cAAc,KAAK,CAAvB;AACAZ,cAAQI,OAAR,CAAgBS,OAAhB,CAAwBC,QAAxB,CAAiCJ,IAAIK,MAAJ,CAAWC,EAA5C,EAAgDC,IAAhD,CAAqD,UAAUC,MAAV,EAAkB;AACrEN,sBAAcM,MAAd;AACD,OAFD;AAGAlB,cAAQI,OAAR,CAAgBe,IAAhB,CAAqBL,QAArB,CAA8BJ,IAAIU,IAAJ,CAASC,MAAvC,EAA+CJ,IAA/C,CAAoD,UAAUG,IAAV,EAAgB;AAClEA,aAAKE,kBAAL,CAAwBV,WAAxB;AACA,eAAOD,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsBC,OAAtB,CAA8B,EAAEC,SAAS,iBAAX,EAA9B,CAAP;AACD,OAHD,EAGGC,KAHH,CAGS,UAAUC,KAAV,EAAiB;AACxB,eAAOjB,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsBI,KAAtB,CAA4BA,KAA5B,CAAP;AACD,OALD;AAMD;;AAED;;;;;;;AAtB8C,GAAD,EA6B5C;AACDnC,SAAK,eADJ;AAEDX,WAAO,SAAS+C,aAAT,CAAuBnB,GAAvB,EAA4BC,GAA5B,EAAiC;AACtCX,cAAQI,OAAR,CAAgBe,IAAhB,CAAqBL,QAArB,CAA8BJ,IAAIU,IAAJ,CAASC,MAAvC,EAA+CJ,IAA/C,CAAoD,UAAUG,IAAV,EAAgB;AAClEA,aAAKU,mBAAL,GAA2Bb,IAA3B,CAAgC,UAAUc,UAAV,EAAsB;AACpD,cAAIA,WAAW3C,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,mBAAOuB,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsBQ,IAAtB,CAA2B,EAAEN,SAAS,eAAX,EAA3B,CAAP;AACD;AACDf,cAAIY,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsBC,OAAtB,CAA8B,EAAEM,YAAYA,UAAd,EAA9B;AACD,SALD,EAKGJ,KALH,CAKS,UAAUC,KAAV,EAAiB;AACxB,iBAAOjB,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsBQ,IAAtB,CAA2BJ,KAA3B,CAAP;AACD,SAPD;AAQD,OATD;AAUD;;AAED;;;;;;;AAfC,GA7B4C,EAmD5C;AACDnC,SAAK,kBADJ;AAEDX,WAAO,SAASmD,gBAAT,CAA0BvB,GAA1B,EAA+BC,GAA/B,EAAoC;AACzCX,cAAQI,OAAR,CAAgB8B,SAAhB,CAA0BC,KAA1B,CAAgC,+CAA+CzB,IAAIU,IAAJ,CAASC,MAAxD,GAAiE,sBAAjE,GAA0FX,IAAIK,MAAJ,CAAWC,EAArG,GAA0G,GAA1I,EAA+IoB,MAA/I,CAAsJ,YAAY;AAChK,eAAOzB,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsBC,OAAtB,CAA8B,EAAEC,SAAS,mBAAX,EAA9B,CAAP;AACD,OAFD,EAEGC,KAFH,CAES,UAAUC,KAAV,EAAiB;AACxB,eAAOjB,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsBQ,IAAtB,CAA2BJ,KAA3B,CAAP;AACD,OAJD;AAKD;;AAED;;;;;;;AAVC,GAnD4C,EAoE5C;AACDnC,SAAK,mBADJ;AAEDX,WAAO,SAASuD,iBAAT,CAA2B3B,GAA3B,EAAgCC,GAAhC,EAAqC;AAC1CX,cAAQI,OAAR,CAAgB8B,SAAhB,CAA0BC,KAA1B,CAAgC,0WAAhC,EAA4YC,MAA5Y,CAAmZ,UAAUE,OAAV,EAAmB;AACpa,eAAO3B,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsBC,OAAtB,CAA8B,EAAEc,SAASD,OAAX,EAA9B,CAAP;AACD,OAFD;AAGD;AANA,GApE4C,CAA/C;;AA6EA,SAAO9B,0BAAP;AACD,CAnFgC,EAAjC;;AAqFA3B,QAAQuB,OAAR,GAAkBI,0BAAlB","file":"FavouriteRecipesController.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _index = require('../models/index');\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\r\n * Favourite recipes controller\r\n */\nvar FavouriteRecipesController = function () {\n  function FavouriteRecipesController() {\n    _classCallCheck(this, FavouriteRecipesController);\n  }\n\n  _createClass(FavouriteRecipesController, null, [{\n    key: 'addFavourite',\n\n    /**\r\n       * Adds a favourite for a user\r\n       * @param {*} req\r\n       * @param {*} res\r\n       * @returns {*} res\r\n       */\n    value: function addFavourite(req, res) {\n      var foundRecipe = void 0;\n      _index2.default.Recipes.findById(req.params.id).then(function (recipe) {\n        foundRecipe = recipe;\n      });\n      _index2.default.User.findById(req.user.userId).then(function (user) {\n        user.addFavouriteRecipe(foundRecipe);\n        return res.status(200).jsend.success({ message: 'Favourite added' });\n      }).catch(function (error) {\n        return res.status(400).jsend.error(error);\n      });\n    }\n\n    /**\r\n       * Method gets the favourite recipes for a user\r\n       * @param {*} req\r\n       * @param {*} res\r\n       * @returns {*} res\r\n       */\n\n  }, {\n    key: 'getFavourites',\n    value: function getFavourites(req, res) {\n      _index2.default.User.findById(req.user.userId).then(function (user) {\n        user.getFavouriteRecipes().then(function (favourites) {\n          if (favourites.length === 0) {\n            return res.status(404).jsend.fail({ message: 'No Favourites' });\n          }\n          res.status(200).jsend.success({ favourites: favourites });\n        }).catch(function (error) {\n          return res.status(400).jsend.fail(error);\n        });\n      });\n    }\n\n    /**\r\n     * Deletes a user favourite\r\n     * @param {*} req\r\n     * @param {*} res\r\n     * @returns {*} res\r\n     */\n\n  }, {\n    key: 'deleteFavourites',\n    value: function deleteFavourites(req, res) {\n      _index2.default.sequelize.query('DELETE FROM \"Favourites\" WHERE \"UserId\" = ' + req.user.userId + ' AND \"RecipeId\" IN (' + req.params.id + ')').spread(function () {\n        return res.status(200).jsend.success({ message: 'Favourite deleted' });\n      }).catch(function (error) {\n        return res.status(400).jsend.fail(error);\n      });\n    }\n\n    /**\r\n     * Get recipes by most favourited\r\n     * @param {*} req\r\n     * @param {*} res\r\n     * @returns {*} res\r\n     */\n\n  }, {\n    key: 'getMostFavourited',\n    value: function getMostFavourited(req, res) {\n      _index2.default.sequelize.query('SELECT \"Recipes\".\"id\", \"Recipes\".\"name\", \"Recipes\".\"description\",\\n    \"Recipes\".\"ingredients\", \"Recipes\".\"image\", \"Recipes\".\"upvotes\",\\n    \"Recipes\".\"downvotes\", \"Recipes\".\"UserId\", count(*) FROM \"Favourites\"\\n    LEFT OUTER JOIN \"Recipes\" ON \"Favourites\".\"RecipeId\" = \"Recipes\".\"id\"\\n    GROUP BY \"Recipes\".\"name\", \"Recipes\".\"id\"\\n    ORDER BY count(*) DESC').spread(function (results) {\n        return res.status(200).jsend.success({ recipes: results });\n      });\n    }\n  }]);\n\n  return FavouriteRecipesController;\n}();\n\nexports.default = FavouriteRecipesController;"]}