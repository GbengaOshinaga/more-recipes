{"version":3,"sources":["../../../dist/controllers/RecipesController.js"],"names":["Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_index","require","_index2","_interopRequireDefault","obj","__esModule","default","_defineProperty","_classCallCheck","instance","TypeError","RecipesController","addRecipe","req","res","ingredientsArray","body","ingredients","split","Recipes","findOne","where","UserId","user","userId","name","then","existingRecipe","status","jsend","fail","message","create","description","image","recipe","success","catch","error","getRecipes","query","sort","order","findAll","group","sequelize","literal","toUpperCase","recipes","from","to","paginateRecipes","searchRecipes","trim","include","model","Reviews","User","getRecipeById","findById","params","id","getFavouriteUsers","userFavourites","favourites","modifyRecipe","update","updatedRecipe","deleteRecipe","destroy","force","addReview","review","RecipeId","userReviews","editReview","updatedReview","deleteReview","op","Sequelize","Op","or","iLike","contains","offset","limit"],"mappings":"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","file":"RecipesController.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _index = require('../models/index');\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\r\n * RecipesController\r\n */\nvar RecipesController = function () {\n  function RecipesController() {\n    _classCallCheck(this, RecipesController);\n  }\n\n  _createClass(RecipesController, null, [{\n    key: 'addRecipe',\n\n    /**\r\n     * Adds a recipe\r\n     * @param {Object} req\r\n     * @param {Object} res\r\n     * @returns {Array} all recipes\r\n     */\n    value: function addRecipe(req, res) {\n      var ingredientsArray = req.body.ingredients.split(',');\n\n      _index2.default.Recipes.findOne({\n        where: {\n          UserId: req.user.userId,\n          name: req.body.name\n        }\n      }).then(function (existingRecipe) {\n        if (existingRecipe) {\n          return res.status(400).jsend.fail({ message: 'You have already created this recipe' });\n        }\n        _index2.default.Recipes.create({\n          name: req.body.name,\n          description: req.body.description,\n          UserId: req.user.userId,\n          image: req.body.image,\n          ingredients: ingredientsArray\n        }).then(function (recipe) {\n          return res.status(201).jsend.success({ recipe: recipe });\n        }).catch(function () {\n          return res.status(400).jsend.error('An error occured');\n        });\n      }).catch(function (error) {\n        return res.status(400).jsend.error(error);\n      });\n    }\n\n    /**\r\n     * Gets Recipes\r\n     * @param {Object} req\r\n     * @param {Object} res\r\n     * @returns {Array} all recipes\r\n     */\n\n  }, {\n    key: 'getRecipes',\n    value: function getRecipes(req, res) {\n      if (req.query.sort && req.query.order) {\n        _index2.default.Recipes.findAll({\n          group: 'id',\n          order: _index2.default.sequelize.literal('max(' + req.query.sort + ') ' + req.query.order.toUpperCase())\n        }).then(function (recipes) {\n          return res.status(200).jsend.success({ recipes: recipes });\n        }).catch(function (error) {\n          return res.status(400).jsend.error({ error: error });\n        });\n      } else if (req.query.from && req.query.to) {\n        this.paginateRecipes(req.query.from, req.query.to, res);\n      } else if (req.query.query) {\n        this.searchRecipes(req.query.query.trim(), res);\n      } else {\n        _index2.default.Recipes.findAll({\n          include: [{\n            model: _index2.default.Reviews,\n            include: [{\n              model: _index2.default.User\n            }]\n          }]\n        }).then(function (recipes) {\n          return res.status(200).jsend.success({ recipes: recipes });\n        }).catch(function (error) {\n          return res.status(400).jsend.error(error);\n        });\n      }\n    }\n\n    /**\r\n     * Gets recipe with specified id\r\n     * @param {Object} req\r\n     * @param {Object} res\r\n     * @returns {Object} res\r\n     */\n\n  }, {\n    key: 'getRecipeById',\n    value: function getRecipeById(req, res) {\n      _index2.default.Recipes.findById(req.params.id, {\n        include: [{\n          model: _index2.default.Reviews,\n          include: [{\n            model: _index2.default.User\n          }]\n        }]\n      }).then(function (recipe) {\n        if (!recipe) {\n          return res.status(404).jsend.fail({ message: 'Recipe with Id of ' + req.params.id + ' does not exist' });\n        }\n        recipe.getFavouriteUsers().then(function (userFavourites) {\n          return res.status(200).jsend.success({ recipe: recipe, favourites: userFavourites });\n        });\n      }).catch(function () {\n        return res.status(400).jsend.error('An error occured');\n      });\n    }\n\n    /**\r\n     * Modifies a recipe\r\n     * @param {Object} req\r\n     * @param {Object} res\r\n     * @returns {Object} Modified recipe\r\n     */\n\n  }, {\n    key: 'modifyRecipe',\n    value: function modifyRecipe(req, res) {\n      var ingredientsArray = void 0;\n      if (req.body.ingredients) {\n        ingredientsArray = req.body.ingredients.split(',');\n      }\n\n      _index2.default.Recipes.findById(req.params.id).then(function (recipe) {\n        if (!recipe) {\n          return res.status(404).jsend.fail({ message: 'The Recipe does not exist' });\n        }\n        if (recipe.UserId !== req.user.userId) {\n          return res.status(401).jsend.fail({ message: 'You are not authorized to edit this recipe' });\n        }\n        recipe.update({\n          name: req.body.name || recipe.name,\n          description: req.body.description || recipe.description,\n          userId: req.user.userId,\n          image: req.body.image || recipe.image,\n          ingredients: ingredientsArray || recipe.ingredients\n        }).then(function (updatedRecipe) {\n          return res.status(200).jsend.success({ updatedRecipe: updatedRecipe });\n        });\n      }).catch(function (error) {\n        return res.jsend.error(error);\n      });\n    }\n\n    /**\r\n     * Deletes specified recipe\r\n     * @param {Object} req\r\n     * @param {Object} res\r\n     * @returns {String} message\r\n     */\n\n  }, {\n    key: 'deleteRecipe',\n    value: function deleteRecipe(req, res) {\n      _index2.default.Recipes.findById(req.params.id).then(function (recipe) {\n        if (!recipe) {\n          return res.status(404).jsend.fail({ message: 'The Recipe does not exist' });\n        }\n        if (recipe.UserId !== req.user.userId) {\n          return res.status(401).jsend.fail({ message: 'You are not authorized to delete this recipe' });\n        }\n        recipe.destroy({ force: true }).then(function () {\n          return res.status(200).jsend.success({ message: 'Recipe has been successfully deleted' });\n        }).catch(function (error) {\n          return res.status(400).jsend.error(error);\n        });\n      }).catch(function (error) {\n        return res.status(400).jsend.error(error);\n      });\n    }\n\n    /**\r\n     * Add review to recipe\r\n     * @param {Object} req\r\n     * @param {Object} res\r\n     * @returns {Object} recipe object\r\n     */\n\n  }, {\n    key: 'addReview',\n    value: function addReview(req, res) {\n      _index2.default.Reviews.create({\n        review: req.body.review,\n        UserId: req.user.userId,\n        RecipeId: req.params.id\n      }).then(function (review) {\n        return _index2.default.Reviews.findById(review.id, { include: [{ model: _index2.default.User }] });\n      }).then(function (userReviews) {\n        return res.status(201).jsend.success({ review: userReviews });\n      }).catch(function (error) {\n        return res.status(400).jsend.error(error);\n      });\n    }\n\n    /**\r\n     * Edits a review\r\n     * @param {Object} req\r\n     * @param {Object} res\r\n     * @returns {Object} res\r\n     */\n\n  }, {\n    key: 'editReview',\n    value: function editReview(req, res) {\n      _index2.default.Reviews.findById(req.params.id).then(function (review) {\n        if (!review) {\n          return res.status(404).jsend.fail({ message: 'The Review does not exist' });\n        }\n        if (review.UserId !== req.user.userId) {\n          return res.status(401).jsend.fail({ message: 'You are not authorized to edit this review' });\n        }\n        review.update({\n          review: req.body.review || review.review\n        }).then(function (updatedReview) {\n          return res.status(200).jsend.success({ updatedReview: updatedReview });\n        }).catch(function (error) {\n          return res.status(400).jsend.error(error);\n        });\n      });\n    }\n\n    /**\r\n     * Deletes a review\r\n     * @param {Object} req\r\n     * @param {Object} res\r\n     * @returns {String} res\r\n     */\n\n  }, {\n    key: 'deleteReview',\n    value: function deleteReview(req, res) {\n      _index2.default.Reviews.findById(req.params.id).then(function (review) {\n        if (!review) {\n          return res.status(404).jsend.fail({ message: 'The Review does not exist' });\n        }\n        if (review.UserId !== req.user.userId) {\n          return res.status(401).jsend.fail({ message: 'You are not authorized to delete this review' });\n        }\n        review.destroy().then(function () {\n          return res.status(200).jsend.success({ message: 'Review has been successfully deleted' });\n        }).catch(function (error) {\n          return res.status(400).jsend.error(error);\n        });\n      });\n    }\n\n    /**\r\n     * Search for recipes\r\n     * @param {String} query\r\n     * @param {Object} res\r\n     * @returns {Array} res\r\n     */\n\n  }, {\n    key: 'searchRecipes',\n    value: function searchRecipes(query, res) {\n      var op = _index2.default.Sequelize.Op;\n\n      _index2.default.Recipes.findAll({\n        where: _defineProperty({}, op.or, {\n          name: _defineProperty({}, op.iLike, '%' + query + '%'),\n          description: _defineProperty({}, op.iLike, '%' + query + '%'),\n          ingredients: _defineProperty({}, op.contains, ['' + query])\n        })\n      }).then(function (recipes) {\n        if (recipes.length === 0) {\n          return res.status(404).jsend.fail({ message: 'No Results Found' });\n        }\n        res.status(200).jsend.success({ recipes: recipes });\n      }).catch(function (error) {\n        return res.status(400).jsend.error(error);\n      });\n    }\n\n    /**\r\n     * Paginate recipes\r\n     * @param {Number} offset\r\n     * @param {Number} limit\r\n     * @param {Object} res\r\n     * @returns {Array} res\r\n     */\n\n  }, {\n    key: 'paginateRecipes',\n    value: function paginateRecipes(offset, limit, res) {\n      _index2.default.Recipes.findAll({ offset: offset, limit: limit }).then(function (recipes) {\n        return res.status(200).jsend.success({ recipes: recipes });\n      }).catch(function (error) {\n        return res.status(400).jsend.error(error);\n      });\n    }\n  }]);\n\n  return RecipesController;\n}();\n\nexports.default = RecipesController;"]}